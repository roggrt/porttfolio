// contentful-type-gen.js
const contentfulManagement = require("contentful-management")
const { writeFileSync } = require("fs")

const managementToken = "CONTENFUL_MANAGEMENT_TOKEN"; // Obtenlo de Contentful -> Settings -> API keys -> Generate Personal Access Token

module.exports = function() {
    const contentfulClient = contentfulManagement.createClient({
        accessToken: managementToken,
    })

    return contentfulClient
        .getSpace("sfme6nh4wom2")
        .then((space) => space.getEnvironment("master"))
        .then((environment) => environment.getTypes())
        .then((response) => {
            const types = response.items.map((contentType) => ({
                name: contentType.name,
                description: contentType.description,
                displayField: contentType.displayField,
                fields: contentType.fields,
            }))

            writeFileSync("./src/types/contentful.d.ts",
                `// Generated by contentful-typescript-codegen
         import { Entry, Asset } from 'contentful';
         
         export interface TypeBlogPostFields {
           title: string;
           slug: string;
           body: Document;
           featuredImage: Asset;
           publishDate: string;
           categories: string[];
           tags?: string[];
           author?: Entry<TypeAuthorFields>;
           seoMetadata?: {
             title?: string;
             description?: string;
             keywords?: string[];
           };
         }

         export type TypeBlogPost = Entry<TypeBlogPostFields>;

         export interface TypeAuthorFields {
           name: string;
           bio?: string;
           avatar?: Asset;
         }

         export type TypeAuthor = Entry<TypeAuthorFields>;
        `
            )
        })
}